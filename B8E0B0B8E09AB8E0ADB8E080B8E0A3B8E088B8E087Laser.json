{"files":[{"id":"d87dfafc-cf6b-44b0-8d66-50edc0a646e8","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Asia/Bangkok\",\n  \"dependencies\": {},\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"webapp\": {\n    \"executeAs\": \"USER_DEPLOYING\",\n    \"access\": \"ANYONE_ANONYMOUS\"\n  }\n}"},{"id":"e8c29472-f54a-413d-a065-863ca347dbdb","name":"รหัส","type":"server_js","source":"// ใช้แสดงหน้าเว็บภายใน Apps Script เท่านั้น\nfunction doGet() {\n  var template \u003d HtmlService.createTemplateFromFile(\u0027booking_laser\u0027);\n  return template.evaluate()\n    .setSandboxMode(HtmlService.SandboxMode.IFRAME)\n    .addMetaTag(\u0027viewport\u0027, \u0027width\u003ddevice-width , initial-scale\u003d1\u0027);\n}\n\n// ใช้รับข้อมูลจากหน้าเว็บภายนอก (เช่น VS Code)\nfunction doPost(e) {\n  try {\n    const data \u003d JSON.parse(e.postData.contents);\n    const message \u003d bookCar(\n      data.carId,\n      data.date,\n      data.startTime,\n      data.endTime,\n      data.userName,\n      data.note\n    );\n\n    return ContentService.createTextOutput(message).setMimeType(ContentService.MimeType.TEXT);\n  } catch (error) {\n    return ContentService.createTextOutput(\"❌ ERROR: \" + error.message).setMimeType(ContentService.MimeType.TEXT);\n  }\n}\n\n// ฟังก์ชันจองเครื่อง (ไม่ต้องแก้ถ้าใช้งานได้แล้ว)\nfunction bookCar(carId, date, startTime, endTime, userName, note) {\n  const calendarId \u003d \"f2cad963b26c87fe96073edd815b80fc71f63dba9cdc3bf5c46fb2bc821e6901@group.calendar.google.com\";\n  const calendar \u003d CalendarApp.getCalendarById(calendarId);\n\n  const startDateTime \u003d new Date(`${date}T${startTime}:00`);\n  const endDateTime \u003d new Date(`${date}T${endTime}:00`);\n\n  const events \u003d calendar.getEvents(startDateTime, endDateTime);\n  for (let event of events) {\n    if (event.getDescription().includes(`Mechine:${carId}`)) {\n      throw new Error(\"ช่วงเวลาดังกล่าวเครื่องได้ถูกจองแล้ว โปรดเลือกช่วงเวลาใหม่\");\n    }\n  }\n\n  const detailCar \u003d `Mechine:${carId}\\nหมายเหตุ:${note || \"ไม่มี\"}`;\n  calendar.createEvent(\n    `หมายเลขเครื่อง ${carId} ผู้จอง ${userName}`,\n    startDateTime,\n    endDateTime,\n    { description: detailCar }\n  );\n\n  return `✅ จองสำเร็จ!\\nเครื่อง: ${carId}\\nวันที่: ${date}\\nเวลา: ${startTime} - ${endTime}`;\n}\n"},{"id":"f3712d5b-af98-4586-84ec-55cf2b68a0be","name":"booking_laser","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml lang\u003d\"th\"\u003e\n\u003chead\u003e\n  \u003cmeta charset\u003d\"UTF-8\" /\u003e\n  \u003cmeta name\u003d\"viewport\" content\u003d\"width\u003ddevice-width, initial-scale\u003d1\" /\u003e\n  \u003ctitle\u003eจองเครื่อง Laser\u003c/title\u003e\n  \u003cstyle\u003e\n    body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 20px; }\n    label, input, select, textarea { display: block; margin: 10px 0; width: 100%; }\n    button { padding: 10px; }\n    .result { margin-top: 20px; font-weight: bold; }\n    .error { color: red; }\n  \u003c/style\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n  \u003ch2\u003eฟอร์มจองเครื่อง Laser\u003c/h2\u003e\n\n  \u003clabel\u003eหมายเลขเครื่อง:\u003c/label\u003e\n  \u003cselect id\u003d\"carId\"\u003e\n    \u003coption value\u003d\"Laser1\"\u003eLaser1\u003c/option\u003e\n    \u003coption value\u003d\"Laser2\"\u003eLaser2\u003c/option\u003e\n  \u003c/select\u003e\n\n  \u003clabel\u003eวันที่:\u003c/label\u003e\n  \u003cinput type\u003d\"date\" id\u003d\"date\" required /\u003e\n\n  \u003clabel\u003eเวลาเริ่ม:\u003c/label\u003e\n  \u003cinput type\u003d\"time\" id\u003d\"startTime\" required /\u003e\n\n  \u003clabel\u003eเวลาสิ้นสุด:\u003c/label\u003e\n  \u003cinput type\u003d\"time\" id\u003d\"endTime\" required /\u003e\n\n  \u003clabel\u003eชื่อผู้จอง:\u003c/label\u003e\n  \u003cinput type\u003d\"text\" id\u003d\"userName\" required /\u003e\n\n  \u003clabel\u003eหมายเหตุ:\u003c/label\u003e\n  \u003ctextarea id\u003d\"note\"\u003e\u003c/textarea\u003e\n\n  \u003cbutton onclick\u003d\"submitBooking()\"\u003eจองเครื่อง\u003c/button\u003e\n\n  \u003cdiv id\u003d\"result\" class\u003d\"result\"\u003e\u003c/div\u003e\n\n  \u003cscript\u003e\n    async function submitBooking() {\n      const payload \u003d {\n        carId: document.getElementById(\"carId\").value,\n        date: document.getElementById(\"date\").value,\n        startTime: document.getElementById(\"startTime\").value,\n        endTime: document.getElementById(\"endTime\").value,\n        userName: document.getElementById(\"userName\").value,\n        note: document.getElementById(\"note\").value\n      };\n\n      const resultDiv \u003d document.getElementById(\"result\");\n      resultDiv.innerText \u003d \"กำลังส่งคำขอ...\";\n      resultDiv.classList.remove(\"error\");\n\n      try {\n        const res \u003d await fetch(\"https://script.google.com/macros/s/PASTE_YOUR_URL_HERE/exec\", {\n          method: \"POST\",\n          body: JSON.stringify(payload),\n          headers: { \"Content-Type\": \"application/json\" }\n        });\n\n        const text \u003d await res.text();\n\n        if (!res.ok || text.includes(\"❌\")) {\n          throw new Error(text);\n        }\n\n        resultDiv.innerText \u003d text;\n      } catch (err) {\n        resultDiv.innerText \u003d \"❌ เกิดข้อผิดพลาด: \" + err.message;\n        resultDiv.classList.add(\"error\");\n      }\n    }\n  \u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},{"id":"3097a4ed-1196-439e-aa48-48347720dad1","name":"script","type":"server_js","source":"// Example fetch call\nfunction bookLaser() {\n  const data \u003d {\n    carId: \"Laser1\",\n    date: \"2025-06-10\",\n    startTime: \"09:00\",\n    endTime: \"10:00\",\n    userName: \"ทดสอบ\",\n    note: \"ทดลองจอง\"\n  };\n\n  fetch(\"https://script.google.com/macros/s/AKfycbw-pQW0duXZAM7h5pZB12hcOX4wQQmydXTokN2zTJTOa7fKReNXJ3e5pFzbHdG1I4OA/exec\", {\n    method: \"POST\",\n    body: JSON.stringify(data),\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n  })\n    .then((res) \u003d\u003e res.text())\n    .then((msg) \u003d\u003e alert(msg))\n    .catch((err) \u003d\u003e alert(\"เกิดข้อผิดพลาด: \" + err));\n}\n"}]}